{% extends 'main/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Kürtçe Sözlük" %}{% endblock %}
{% block page_header %}{% trans "Sözlük" %}{% endblock %}

{% block meta_description %}{% trans "Kürtçe Sözlük - Kelime arama, ekleme ve düzenleme" %}{% endblock %}

{% block extra_css %}
    <link href="{% static 'main/css/sozluk.css' %}" rel="stylesheet">
    <link href="{% static 'main/css/modern-headers.css' %}" rel="stylesheet">
{% endblock %}

{% block extra_head %}
    <meta name="csrf-token" content="{{ csrf_token }}">
{% endblock %}

{% block content %}
<div class="container-fluid px-0">
    <!-- Modern Hero Section -->
    <div class="modern-hero">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="hero-content">
                        <h1 class="hero-title">
                            <i class="bi bi-book-half"></i>
                            {% trans "Kürtçe Sözlük" %}
                        </h1>
                        <p class="hero-subtitle">{% trans "Kelime arama, ekleme ve düzenleme" %}</p>
                        <div class="hero-actions">
                            <button class="hero-btn hero-btn-primary" onclick="focusAddForm()">
                                <i class="bi bi-plus-circle"></i>
                                {% trans "Yeni Kelime Ekle" %}
                            </button>
                            <button class="hero-btn hero-btn-outline" onclick="focusSearch()">
                                <i class="bi bi-search"></i>
                                {% trans "Kelime Ara" %}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="hero-stats">
                        <div class="hero-stats-number">{{ kelime_sayisi|default:"0" }}</div>
                        <p class="hero-stats-label">{% trans "Toplam Kelime" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container sozluk-container">
        
        <!-- Kelime Ekleme Formu -->
        <div class="card mb-4 shadow-lg">
            <div class="card-body">
                <h5 class="card-title mb-3">
                    <i class="bi bi-plus-circle-fill me-2 text-primary"></i>
                    {% trans "Yeni Kelime Ekle" %}
                </h5>
                <form id="sozluk-form" method="post" action="{% url 'sozluk_ana_sayfa' %}" class="needs-validation" novalidate>
                    {% csrf_token %}
                    {{ form.as_p }}
                    <div id="form-errors" class="alert alert-danger d-none" role="alert"></div>
                    <button type="submit" class="btn btn-primary rounded-pill">
                        <i class="bi bi-plus-circle me-1"></i> {% trans "Kelime Ekle" %}
                    </button>
                </form>
            </div>
        </div>

        <!-- Arama Formu -->
        <div class="card mb-4 shadow-lg">
            <div class="card-body">
                <h5 class="card-title mb-3">
                    <i class="bi bi-search me-2 text-primary"></i>
                    {% trans "Kelime Ara" %}
                </h5>
                <form id="sozluk-arama-form">
                    <div class="row g-2">
                        <div class="col-12 col-md-6">
                            <input type="text" 
                                   id="arama-input" 
                                   class="form-control" 
                                   placeholder="{% trans 'Kelime ara (örnek: su)' %}" 
                                   aria-label="{% trans 'Arama' %}"
                                   autocomplete="off">
                        </div>
                        <div class="col-6 col-md-2">
                            <select id="tur-filtresi" class="form-select" aria-label="{% trans 'Kelime türü filtresi' %}">
                                <option value="">{% trans "Tüm Türler" %}</option>
                                <option value="isim">{% trans "İsim" %}</option>
                                <option value="fiil">{% trans "Fiil" %}</option>
                                <option value="sifat">{% trans "Sıfat" %}</option>
                                <option value="zarf">{% trans "Zarf" %}</option>
                            </select>
                        </div>
                        <div class="col-6 col-md-2">
                            <select id="dil-filtresi" class="form-select" aria-label="{% trans 'Dil filtresi' %}">
                                <option value="">{% trans "Tüm Diller" %}</option>
                                <option value="turkce">{% trans "Türkçesi Olan" %}</option>
                                <option value="ingilizce">{% trans "İngilizcesi Olan" %}</option>
                            </select>
                        </div>
                        <div class="col-12 col-md-2">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="bi bi-search me-1"></i> {% trans "Ara" %}
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Harf Listesi -->
        <div class="card mb-4 shadow-lg">
            <div class="card-body">
                <h5 class="card-title mb-3">
                    <i class="bi bi-alphabet me-2 text-primary"></i>
                    {% trans "Harf Seçimi" %}
                </h5>
                <div class="d-flex flex-wrap gap-3">
                    <button class="btn btn-link text-decoration-none text-primary fw-bold border-bottom border-primary border-2 p-0" onclick="initTumKelimeler(true)" style="padding: 5px 0;">{% trans "Tümü" %}</button>
                    {% for harf in harfler %}
                        <a href="{% url 'sozluk_harf' harf %}" class="text-decoration-none text-muted" style="padding: 5px 0;">{{ harf|upper }}</a>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Kelime Listesi -->
        <div class="card mb-4 shadow-lg">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-book me-2 text-primary"></i>
                        {% trans "Tüm Kelimeler" %}
                    </h5>
                </div>
                <div id="arama-sonuc-listesi" class="list-group list-group-flush">
                </div>
                <div id="loading" class="text-center mt-3 d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">{% trans "Yükleniyor..." %}</span>
                    </div>
                </div>
                <div id="error-message" class="alert alert-danger mt-3 d-none" role="alert"></div>
            </div>
        </div>

        <!-- Düzenleme Modalı -->
        <div class="modal fade" id="editKelimeModal" tabindex="-1" aria-labelledby="editKelimeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editKelimeModalLabel">
                            <i class="bi bi-pencil-square me-2"></i>{% trans "Kelimeyi Düzenle" %}
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% trans 'Kapat' %}"></button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-kelime-form" method="post" class="needs-validation" novalidate>
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="kelime" class="form-label">{% trans "Kelime" %}</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="kelime" 
                                       name="kelime" 
                                       required
                                       autocomplete="off">
                                <div class="invalid-feedback">
                                    {% trans "Lütfen bir kelime girin." %}
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="detay" class="form-label">{% trans "Açıklama" %}</label>
                                <textarea class="form-control" 
                                          id="detay" 
                                          name="detay" 
                                          rows="4" 
                                          required></textarea>
                                <div class="invalid-feedback">
                                    {% trans "Lütfen kelimenin açıklamasını girin." %}
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="turkce_karsiligi" class="form-label">{% trans "Türkçe Karşılığı" %}</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="turkce_karsiligi" 
                                       name="turkce_karsiligi" 
                                       placeholder="{% trans 'Türkçe karşılığı (isteğe bağlı)' %}"
                                       autocomplete="off">
                            </div>
                            <div class="mb-3">
                                <label for="ingilizce_karsiligi" class="form-label">{% trans "İngilizce Karşılığı" %}</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="ingilizce_karsiligi" 
                                       name="ingilizce_karsiligi" 
                                       placeholder="{% trans 'İngilizce karşılığı (isteğe bağlı)' %}"
                                       autocomplete="off">
                            </div>
                            <div class="mb-3">
                                <label for="tur" class="form-label">{% trans "Tür" %}</label>
                                <select class="form-select" id="tur" name="tur">
                                    <option value="">{% trans "Seçin" %}</option>
                                    <option value="isim">{% trans "İsim" %}</option>
                                    <option value="fiil">{% trans "Fiil" %}</option>
                                    <option value="sifat">{% trans "Sıfat" %}</option>
                                    <option value="zarf">{% trans "Zarf" %}</option>
                                </select>
                            </div>
                            <div id="edit-form-errors" class="alert alert-danger d-none" role="alert"></div>
                            <div class="d-flex justify-content-end gap-2">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "İptal" %}</button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-check2 me-1"></i>{% trans "Kaydet" %}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
    <script type="module">
        // Modern JavaScript modules
        import { initSozlukForm, initSozlukLoader } from "{% static 'main/js/modules/sozluk/sozluk_loader.js' %}";
        import { initSozlukArama, initTumKelimeler, bindKelimeActions } from "{% static 'main/js/modules/sozluk/sozluk_search.js' %}";
        import { initEditKelimeForm } from "{% static 'main/js/modules/sozluk/sozluk_form.js' %}";
        import { initDetayEkleForm, initEditDetayForm } from "{% static 'main/js/modules/sozluk/sozluk_detay.js' %}";
        
        // Initialize all features when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Enable Bootstrap form validation
            const forms = document.querySelectorAll('.needs-validation');
            forms.forEach(form => {
                form.addEventListener('submit', event => {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                });
            });

            // Initialize dictionary features
            const cleanup = {
                loader: initSozlukLoader(''),
                search: initSozlukArama()
            };
            
            // Auto-load all words on page load
            setTimeout(() => {
                initTumKelimeler(true);
            }, 100);

            // Initialize forms
            initSozlukForm();
            initEditKelimeForm();
            initDetayEkleForm();
            initEditDetayForm();
            bindKelimeActions();

            // Cleanup on page unload
            window.addEventListener('unload', () => {
                Object.values(cleanup).forEach(fn => fn?.());
            });
        });
        
        // Hero section butonları için fonksiyonlar
        window.focusAddForm = function() {
            const addForm = document.querySelector('#sozluk-form');
            if (addForm) {
                addForm.scrollIntoView({ behavior: 'smooth' });
                const firstInput = addForm.querySelector('input, textarea');
                if (firstInput) firstInput.focus();
            }
        };
        
        window.focusSearch = function() {
            const searchInput = document.querySelector('#arama-input');
            if (searchInput) {
                searchInput.focus();
                searchInput.scrollIntoView({ behavior: 'smooth' });
            }
        };
    </script>
{% endblock %}